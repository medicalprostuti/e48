<!DOCTYPE html>
<html lang="bn">
  <head>
    <script>
      document.addEventListener("contextmenu", (event) =>
        event.preventDefault()
      );
      document.addEventListener("keydown", (event) => {
        if (
          (event.ctrlKey &&
            ["u", "s", "i", "j"].includes(event.key.toLowerCase())) ||
          event.key === "F12"
        ) {
          event.preventDefault();
        }
      });
    </script>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Online Exam</title>
    <!-- Chart.js CDN -->

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&display=swap");

      body {
        font-family: "Hind Siliguri", sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f4f4f4;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }

      .container {
        font-family: "Hind Siliguri", sans-serif;
        width: 100%;
        margin: auto;
        background-color: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        min-height: 80vh;
      }

      .exam-content {
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      h1 {
        color: #1b0b54;
        text-align: center;
        margin-bottom: 10px;
      }

      #timer {
        font-size: 20px;
        color: #1b0b54;
        margin-bottom: 5px;
        font-weight: normal;
        text-align: center;
      }

      #exam-info {
        font-size: 16px;
        color: black;
        margin-bottom: 20px;
        text-align: center;
      }

      #exam {
        width: 100%;
        min-height: 100px;
      }

      .chart-container {
        width: 200px;
        height: 200px;
        margin: 10px auto;
        background-color: #f9f9f9;
        border-radius: 15px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        display: none;
        padding: 10px;
      }

      .chart-container.visible {
        display: block;
      }

      .question-container {
        text-align: left;
        margin-bottom: 20px;
        display: block;
      }

      .question-label {
        font-weight: bold;
        color: #1b0b54;
        margin-bottom: 10px;
      }

      .options {
        margin-top: 10px;
      }

      .option {
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        cursor: pointer;
        padding: 5px;
        border-radius: 5px;
        text-transform: uppercase;
      }

      .circle {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        border: 2px solid #1b0b54;
        margin-right: 10px;
        display: flex;
        justify-content: center;
        align-items: center;
        color: #1b0b54;
        font-weight: bold;
        font-size: 18px;
      }

      .selected .circle {
        background-color: #1b0b54;
        color: white;
      }

      .correct-text {
        color: green !important;
      }

      .incorrect-text {
        color: #ff0800 !important;
      }

      .unattempted-text {
        color: orange !important;
      }

      #submitBtn {
        font-family: hind siliguri;
        padding: 15px 30px;
        background-color: #1b0b54;
        color: white;
        border: none;
        cursor: pointer;
        font-size: 18px;
        font-weight: bold;
        border-radius: 10px;
        margin-top: 20px;
        width: 200px;
        transition: background-color 0.3s ease;
      }

      #submitBtn:hover {
        background-color: #1b0b54;
      }

      .popup {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: white;
        padding: 20px;
        width: 300px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        border-radius: 10px;
        text-align: center;
        display: none;
        z-index: 1000;
        transition: transform 0.5s ease, opacity 0.5s ease;
      }

      .popup.slide-out {
        transform: translate(-50%, -100%);
        opacity: 0;
      }

      .popup-header {
        background-color: #1b0b54;
        color: white;
        padding: 10px;
        font-size: 20px;
        font-weight: bold;
        border-radius: 10px 10px 0 0;
      }

      .popup-body {
        padding: 15px;
      }

      .popup-body p {
        margin: 10px 0;
      }

      .confirm-btn {
        font-family: hind siliguri;
        background-color: #34c759;
        color: white;
        padding: 8px 15px;
        border: none;
        cursor: pointer;
        font-size: 14px;
        border-radius: 5px;
        margin: 5px;
      }

      .confirm-btn:hover {
        background-color: #34c759;
      }

      .cancel-btn {
        background-color: #ff3b30;
        color: white;
        padding: 8px 15px;
        border: none;
        cursor: pointer;
        font-size: 14px;
        border-radius: 5px;
        margin: 5px;
      }

      .cancel-btn:hover {
        background-color: #e02b21;
      }

      .explanation-dropdown {
        display: none;
        margin-top: 10px;
      }

      .explanation-dropdown.visible {
        display: block;
      }

      .explanation-btn {
        background-color: #1b0b54;
        color: white;
        padding: 8px 15px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        font-family: "Hind Siliguri", sans-serif;
        width: 40%;
        text-align: left;
        position: relative;
      }

      .explanation-btn:hover {
        background-color: #1b0b54;
      }

      .explanation-btn::after {
        content: "▼";
        position: absolute;
        right: 10px;
        font-size: 12px;
      }

      .explanation-btn.active::after {
        content: "▲";
      }

      .explanation-content {
        display: none;
        padding: 15px;
        background-color: #f9f9f9;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 14px;
        color: #000000;
        text-align: left;
        max-height: 450px;
        overflow-y: auto;
        margin-top: 5px;
      }

      .explanation-content.visible {
        display: block;
      }

      .explanation-content p {
        margin: 0 0 10px 0;
      }

      .explanation-content ul {
        margin: 0;
        padding-left: 20px;
      }

      .explanation-content li {
        margin-bottom: 5px;
      }

      .explanation-content strong {
        color: #1b0b54;
      }

      .explanation-label {
        font-weight: bold;
        color: #1b0b54;
        margin-bottom: 10px;
        display: block;
      }

      .locked .option {
        pointer-events: none;
        cursor: default;
      }

      .locked .option.selected {
        pointer-events: none;
        cursor: default;
      }
    </style>
  </head>

  <body>
    <div class="container" id="examContainer">
      <div class="exam-content">
        <h1>ইংরেজী অনুশীলন</h1>
        <div id="timer"></div>
        <div id="exam-info"></div>
        <div class="chart-container">
          <canvas id="scoreChart"></canvas>
        </div>
        <div id="exam">
          <!-- Questions will be generated dynamically -->
        </div>
        <button id="submitBtn">সাবমিট</button>
      </div>
    </div>

    <div class="popup" id="scorePopup">
      <div class="popup-header">তোমার স্কোর</div>
      <div class="popup-body">
        <p><strong>মোট প্রশ্ন:</strong> <span id="totalQuestions"></span></p>
        <p>
          <strong>উত্তর দিয়েছো:</strong>
          <span style="color: #000000" id="answered"></span>
        </p>
        <p>
          <strong>সঠিক উত্তর:</strong>
          <span style="color: #0ab853" id="correctAnswers"></span>
        </p>
        <p>
          <strong>ভুল উত্তর:</strong>
          <span style="color: #f81010" id="wrongAnswers"></span>
        </p>
        <p>
          <strong>অনুত্তরিত:</strong>
          <span style="color: #ffc801" id="unanswered"></span>
        </p>
        <p><strong>তোমার চূড়ান্ত স্কোর:</strong></p>
        <h2 style="color: #1b0b54"><span id="finalScore"></span></h2>
        <form id="scoreForm" action="https://formspree.io/f/xpby" method="POST">
          <input type="hidden" name="userID" id="formUserID" />
          <input type="hidden" name="finalScore" id="formFinalScore" />
          <input type="hidden" name="correctAnswers" id="formCorrectAnswers" />
          <input type="hidden" name="wrongAnswers" id="formWrongAnswers" />
          <input type="hidden" name="unanswered" id="formUnanswered" />
          <button
            type="submit"
            class="confirm-btn"
            style="background-color: #1b0b54"
          >
            <b>ওকে</b>
          </button>
        </form>
      </div>
    </div>

    <div class="popup" id="confirmPopup">
      <div class="popup-header">কনফার্ম করো</div>
      <div class="popup-body">
        <p>
          ভালো করে দেখে নাও! <br />
          পরীক্ষা শেষ করতে চাও তো?
        </p>
        <button class="confirm-btn" onclick="confirmSubmit()">
          <b>হ্যাঁ</b>
        </button>
        <button class="cancel-btn" onclick="cancelSubmit()"><b>না</b></button>
      </div>
    </div>

    <script>
      let chartInstance = null;

      document.addEventListener("DOMContentLoaded", function () {
        console.log("DOM fully loaded and parsed");
        const examContainer = document.getElementById("examContainer");
        if (!examContainer) {
          console.error("Exam container not found!");
          return;
        }
        try {
          sessionStorage.setItem("isLoggedIn", "true");
          sessionStorage.setItem("userID", "anonymous");
          console.log(
            "Session storage set: isLoggedIn = true, userID = anonymous"
          );
        } catch (e) {
          console.error("Session storage error:", e);
        }
        examContainer.style.display = "block";
        console.log("Exam container displayed");
        startTimer();
        generateQuestions();

        window.addEventListener("beforeunload", function (event) {
          if (
            examContainer.style.display === "block" &&
            sessionStorage.getItem("isLoggedIn") === "true"
          ) {
            autoSubmitScore();
          }
        });
      });

      const questions = [
        {
          id: 1,
          question: "Rahat will be going to the US, ___ she?",
          options: {
            a: "isn’t",
            b: "won’t",
            c: "can’t",
            d: "didn’t",
          },
          correct: "b",
          explanation:
            "<p>Tag Question-এর নিয়মানুসারে, যদি মূল Statement-টি Affirmative (হ্যাঁ-বাচক) হয়, তাহলে Tag Question-টি Negative (না-বাচক) হবে। প্রদত্ত বাক্যে auxiliary verb হিসেবে 'will' আছে। এর Negative contracted form হলো 'won’t'। Statement-এর subject 'Rahat' (female), তাই Tag Question-এর pronoun হবে 'she'। সুতরাং, সঠিক Tag Questionটি হবে 'won’t she?'।</p>",
        },
        {
          id: 2,
          question: "She will be studying science, ___?",
          options: {
            a: "isn’t she",
            b: "will she not",
            c: "wouldn’t she",
            d: "won’t she",
          },
          correct: "d",
          explanation:
            "<p>এই বাক্যটি Future Continuous Tense-এ আছে এবং Statement-টি Affirmative। Tag Question গঠনের সময় Statement-এর Auxiliary verb-টিই ব্যবহৃত হয়। এখানে Auxiliary verb হলো 'will'। Affirmative Statement-এর জন্য Negative Tag ব্যবহৃত হয়, তাই 'will' এর Negative contracted form হবে 'won’t'। Subject 'She' হওয়ায় Tag-এর pronounও 'she' হবে। অতএব, সঠিক Tag Questionটি হলো 'won’t she?'।</p>",
        },
        {
          id: 3,
          question: "The universities have opened recently, ___?",
          options: {
            a: "aren’t they",
            b: "hasn’t they",
            c: "haven’t they",
            d: "weren’t they",
          },
          correct: "c",
          explanation:
            "<p>এখানে Statement-টি Present Perfect Tense-এ আছে এবং এটি Affirmative। Present Perfect Tense-এর Auxiliary verb হলো 'have' বা 'has'। Statement-এ 'have' ব্যবহৃত হয়েছে। Affirmative Statement-এর Tag Question Negative হয়, তাই 'have' এর Negative contracted form হলো 'haven’t'। Subject 'The universities' একটি Plural Noun, তাই Tag-এর pronoun হবে 'they'। সুতরাং, সঠিক Tag Questionটি হলো 'haven’t they?'।</p>",
        },
        {
          id: 4,
          question: "They have tried but failed, ___?",
          options: {
            a: "haven’t they",
            b: "aren’t they",
            c: "don’t they",
            d: "didn’t they",
          },
          correct: "a",
          explanation:
            "<p>এই বাক্যটি Present Perfect Tense-এ আছে (have tried) এবং Statement-টি Affirmative। Tag Question-এর নিয়ম অনুযায়ী, Statement-এর Auxiliary verb-টিই Tag-এ বসে। এখানে Auxiliary verb হলো 'have'। যেহেতু Statement-টি Affirmative, Tag Question-টি Negative হবে। তাই 'have' এর Negative contracted form 'haven’t' বসবে। Subject 'They' হওয়ায় Tag-এর pronounও 'they' হবে। সুতরাং, সঠিক Tag Questionটি হলো 'haven’t they?'।</p>",
        },
        {
          id: 5,
          question: "The team is disqualified, ___?",
          options: {
            a: "isn’t it",
            b: "wasn’t it",
            c: "hasn’t it",
            d: "doesn’t it",
          },
          correct: "a",
          explanation:
            "<p>এই বাক্যটি Present Indefinite Tense-এ 'be' verb (is) ব্যবহার করে গঠিত একটি Passive Voice-এর বাক্য। Statement-টি Affirmative। Tag Question গঠনের জন্য Statement-এর Auxiliary verb-টিই ব্যবহৃত হয়। এখানে Auxiliary verb হলো 'is'। যেহেতু Statement-টি Affirmative, Tag Question-টি Negative হবে, তাই 'is' এর Negative contracted form হলো 'isn’t'। Subject 'The team' একটি Collective Noun যা সাধারণত 'it' দ্বারা নির্দেশিত হয়। তাই Tag-এর pronoun হবে 'it'। সুতরাং, সঠিক Tag Questionটি হলো 'isn’t it?'।</p>",
        },
        {
          id: 6,
          question: "She could have been more discreet, ___?",
          options: {
            a: "didn’t she",
            b: "can’t she",
            c: "won’t she",
            d: "couldn’t she",
          },
          correct: "d",
          explanation:
            "<p>এই বাক্যে 'could have' একটি Modal Auxiliary verb combination। Statement-টি Affirmative। Tag Question গঠনের সময়, Modal Auxiliary verb-এর প্রথম অংশটিই Tag-এ ব্যবহৃত হয়। এখানে Modal Auxiliary verb হলো 'could'। যেহেতু Statement-টি Affirmative, Tag Question-টি Negative হবে। তাই 'could' এর Negative contracted form হলো 'couldn’t'। Subject 'She' হওয়ায় Tag-এর pronounও 'she' হবে। সুতরাং, সঠিক Tag Questionটি হলো 'couldn’t she?'।</p>",
        },
        {
          id: 7,
          question: "I need some books, ___?",
          options: {
            a: "needn’t I",
            b: "need I",
            c: "don’t I",
            d: "won’t I",
          },
          correct: "c",
          explanation:
            "<p>যদি 'need' একটি Principal verb হিসেবে ব্যবহৃত হয় (Modal Auxiliary verb হিসেবে নয়), তাহলে Tag Question গঠনের জন্য Tense অনুযায়ী 'do', 'does' বা 'did' ব্যবহার করতে হয়। এখানে 'need' Present Indefinite Tense-এর Principal verb। Statement-টি Affirmative। তাই Negative Tag Question-এর জন্য 'do' এর Negative contracted form 'don’t' বসবে। Subject 'I' হওয়ায় Tag-এর pronounও 'I' হবে। সুতরাং, সঠিক Tag Questionটি হলো 'don’t I?'।</p>",
        },
        {
          id: 8,
          question: "Oh, no! I’m in the wrong classroom again, ___?",
          options: {
            a: "aren’t I",
            b: "am I",
            c: "is it",
            d: "don’t I",
          },
          correct: "a",
          explanation:
            "<p>Tag Question-এর একটি বিশেষ নিয়ম হলো, যদি Statement-এর Subject 'I' হয় এবং Verb 'am' হয় (যেমন 'I am'), তাহলে Tag Question-এ 'am not I' না হয়ে 'aren’t I' হয়। যেহেতু Statement-টি Affirmative, Tag Question-টি Negative হবে। সুতরাং, সঠিক Tag Questionটি হলো 'aren’t I?'।</p>",
        },
        {
          id: 9,
          question: "Put in the suitable tag. I’m late, ___?",
          options: {
            a: "am not I",
            b: "am I",
            c: "aren’t I",
            d: "isn’t I",
          },
          correct: "c",
          explanation:
            "<p>এই বাক্যটিও পূর্বের বাক্যের মতোই 'I am' দিয়ে গঠিত। Tag Question-এর নিয়মানুসারে, 'I am' এর ক্ষেত্রে Negative Tag Question-টি 'aren’t I' হয়, 'am not I' হয় না। যেহেতু Statement-টি Affirmative ('I’m late' = 'I am late'), Tag Question-টি Negative হবে। তাই সঠিক উত্তর হলো 'aren’t I?'।</p>",
        },
        {
          id: 10,
          question: "Let’s sit under these trees, ___?",
          options: {
            a: "shall we",
            b: "will we",
            c: "should we",
            d: "can we",
          },
          correct: "a",
          explanation:
            "<p>যদি কোনো Imperative Sentence 'Let’s' বা 'Let us' দিয়ে শুরু হয় (যা প্রস্তাব বোঝায়), তাহলে Tag Question সবসময় 'shall we' হবে। এই নিয়মটি যেকোনো 'Let’s' বা 'Let us' যুক্ত বাক্যের জন্য প্রযোজ্য। সুতরাং, সঠিক Tag Questionটি হলো 'shall we?'।</p>",
        },
        {
          id: 11,
          question: "Which one is the correct tag question?",
          options: {
            a: "Nothing is certain, is that?",
            b: "There is something wrong with her, isn’t there?",
            c: "Most of them know English, didn’t they?",
            d: "You speak Bangla, don’t you?",
          },
          correct: "b, d",
          explanation:
            "<p>এখানে একাধিক সঠিক Tag Question রয়েছে।</p><br> <p>১. (A) Nothing is certain, is that? - এটি ভুল। 'Nothing' একটি Negative শব্দ, তাই Statement-টি Negative। Tag Question Positive হবে এবং 'nothing' এর জন্য pronoun 'it' হবে, 'that' নয়। তাই সঠিক Tag Question হবে 'Nothing is certain, is it?'।</p><br> <p>২. (B) There is something wrong with her, isn’t there? - এটি সঠিক। 'There' যদি Subject হিসেবে ব্যবহৃত হয়, তাহলে Tag Question-এও 'there' ব্যবহৃত হয়। 'Something' এর জন্য 'it' বসলেও, এখানে 'there is' এর গঠন অনুসরণ করা হয়েছে। Statement-টি Affirmative, তাই Tag Question Negative হবে। সুতরাং, 'is' এর Negative contracted form 'isn’t' এবং 'there' ব্যবহৃত হয়েছে।</p><br> <p>৩. (C) Most of them know English, didn’t they? - এটি ভুল। 'Know' একটি Principal verb এবং এটি Present Indefinite Tense-এ আছে। Present Indefinite Tense-এর জন্য 'do' বা 'does' ব্যবহার করা হয়। Subject 'Most of them' (plural) হওয়ায় 'do' ব্যবহৃত হবে। Statement-টি Affirmative, তাই Tag Question Negative হবে। সুতরাং, সঠিক Tag Question হবে 'Most of them know English, don’t they?'।</p><br> <p>৪. (D) You speak Bangla, don’t you? - এটি সঠিক। এই বাক্যটি Present Indefinite Tense-এ আছে এবং 'speak' একটি Principal verb। Statement-টি Affirmative। তাই Negative Tag Question-এর জন্য 'do' এর Negative contracted form 'don’t' বসবে। Subject 'You' হওয়ায় Tag-এর pronounও 'you' হবে। সুতরাং, সঠিক Tag Questionটি হলো 'don’t you?'।</p>",
        },
        {
          id: 12,
          question: "Nobody has eaten yet, ___?",
          options: {
            a: "has they",
            b: "haven’t they",
            c: "hasn’t they",
            d: "have they",
          },
          correct: "d",
          explanation:
            "<p>এই বাক্যে 'Nobody' একটি Negative শব্দ, যা Statement-টিকে Negative করে তোলে। তাই Tag Question Positive হবে। 'Nobody' এর জন্য Tag Question-এর Subject সবসময় 'they' হয়। যেহেতু 'has eaten' Present Perfect Tense-এ আছে এবং 'they' এর সাথে 'have' ব্যবহৃত হয়, তাই সঠিক Tag Question হবে 'have they?'। 'Nobody' Negative হওয়ায় 'not' ব্যবহৃত হবে না।</p>",
        },
        {
          id: 13,
          question: "We have got a lot on our hands, ___?",
          options: {
            a: "isn’t it",
            b: "have we",
            c: "have we not",
            d: "haven’t we",
          },
          correct: "d",
          explanation:
            "<p>এই বাক্যটি Present Perfect Tense-এ আছে এবং 'have got' একটি Auxiliary verb combination। Statement-টি Affirmative। Tag Question গঠনের জন্য Statement-এর Auxiliary verb-টিই ব্যবহৃত হয়। এখানে Auxiliary verb হলো 'have'। যেহেতু Statement-টি Affirmative, Tag Question-টি Negative হবে। তাই 'have' এর Negative contracted form 'haven’t' বসবে। Subject 'We' হওয়ায় Tag-এর pronounও 'we' হবে। সুতরাং, সঠিক Tag Questionটি হলো 'haven’t we?'।</p>",
        },
        {
          id: 14,
          question:
            "Which one is the appropriate question tag? 'Everything looked beautiful, ___'",
          options: {
            a: "didn’t they?",
            b: "wasn’t it",
            c: "didn’t it?",
            d: "did it?",
          },
          correct: "c",
          explanation:
            "<p>'Everything' Subject হিসেবে থাকলে Tag Question-এর pronoun সবসময় 'it' হয়। মূল Statement-টি 'looked' (Past Indefinite Tense) এবং এটি Affirmative। Past Indefinite Tense-এর জন্য 'did' ব্যবহৃত হয়। যেহেতু Statement-টি Affirmative, Tag Question-টি Negative হবে। তাই 'did' এর Negative contracted form 'didn’t' বসবে। সুতরাং, সঠিক Tag Questionটি হলো 'didn’t it?'।</p>",
        },
        {
          id: 15,
          question: "Choose the correct tag question? I finished my duty, ___?",
          options: {
            a: "I finished my duty, amn’t I?",
            b: "I finished my duty, did I?",
            c: "I finished my duty, didn’t I?",
            d: "I finished my duty, don’t I?",
          },
          correct: "c",
          explanation:
            "<p>মূল Statement-টি 'I finished my duty' (Past Indefinite Tense)। এখানে 'finished' একটি Principal verb। Past Indefinite Tense-এর জন্য Tag Question-এ 'did' ব্যবহৃত হয়। যেহেতু Statement-টি Affirmative, Tag Question-টি Negative হবে। তাই 'did' এর Negative contracted form 'didn’t' বসবে। Subject 'I' হওয়ায় Tag-এর pronounও 'I' হবে। সুতরাং, সঠিক Tag Questionটি হলো 'didn’t I?'।</p>",
        },
        {
          id: 16,
          question:
            "Choose the appropriate tag question of the sentence 'He never goes out without his dog, ___?'",
          options: {
            a: "does he",
            b: "doesn’t he",
            c: "does never he",
            d: "does ever he",
          },
          correct: "a",
          explanation:
            "<p>এই বাক্যে 'never' একটি Negative adverb, যা Statement-টিকে Negative করে তোলে। তাই Tag Question Positive হবে। Statement-টি 'goes' (Present Indefinite Tense)-এ আছে এবং 'goes' একটি Principal verb। Present Indefinite Tense-এর জন্য 'do' বা 'does' ব্যবহৃত হয়। Subject 'He' (Third Person Singular) হওয়ায় 'does' বসবে। যেহেতু Statement-টি Negative, Tag Question Positive হবে। তাই সঠিক Tag Questionটি হলো 'does he?'।</p>",
        },
        {
          id: 17,
          question: "Which of the following has incorrect tag?",
          options: {
            a: "I am your friend, amn’t I?",
            b: "He used to play football, didn’t he?",
            c: "Manik can not swim, can he?",
            d: "Have a cup of tea, won’t you?",
          },
          correct: "a",
          explanation:
            "<p>এখানে ভুল Tag Questionটি শনাক্ত করতে হবে।</p><br> <p>১. (A) I am your friend, amn’t I? - এটি ভুল। 'I am' এর ক্ষেত্রে Tag Question-এ 'amn’t I' হয় না, বরং 'aren’t I' হয়। এটি Tag Question-এর একটি ব্যতিক্রমী নিয়ম।</p><br> <p>২. (B) He used to play football, didn’t he? - এটি সঠিক। 'used to' যুক্ত বাক্যের ক্ষেত্রে Tag Question-এ 'didn’t' ব্যবহৃত হয়। Statement-টি Affirmative, তাই Tag Question Negative হবে।</p><br> <p>৩. (C) Manik can not swim, can he? - এটি সঠিক। Statement-টি Negative ('can not'), তাই Tag Question Positive হবে। Auxiliary verb 'can' ব্যবহৃত হয়েছে এবং Subject 'Manik' (পুরুষ) হওয়ায় pronoun 'he' ব্যবহৃত হয়েছে।</p><br> <p>৪. (D) Have a cup of tea, won’t you? - এটি সঠিক। Imperative Sentence-এর ক্ষেত্রে (অনুরোধ বা নির্দেশ) Tag Question 'will you' বা 'won’t you' হতে পারে। এখানে 'won’t you' ব্যবহার করা হয়েছে যা সঠিক।</p>",
        },
        {
          id: 18,
          question: "Which one is a correct tag question of 'let’s go out'?",
          options: {
            a: "Let’s go out, do we?",
            b: "Let’s go out, are we?",
            c: "Let’s go out, shall we?",
            d: "Let’s go out, will we?",
          },
          correct: "c",
          explanation:
            "<p>Tag Question-এর নিয়মানুসারে, 'Let’s' বা 'Let us' দিয়ে শুরু হওয়া Imperative Sentence-এর জন্য Tag Question সবসময় 'shall we' হবে। এটি একটি নির্দিষ্ট নিয়ম যা প্রস্তাব বোঝাতে ব্যবহৃত হয়। সুতরাং, সঠিক Tag Questionটি হলো 'shall we?'।</p>",
        },
        {
          id: 19,
          question: "I take a public bus, I’ll get late, ___?",
          options: {
            a: "isn’t it",
            b: "is it",
            c: "won’t I",
            d: "will I",
          },
          correct: "c",
          explanation:
            "<p>এই বাক্যে দুটি Clause আছে: 'I take a public bus' এবং 'I’ll get late'। Tag Question সাধারণত Main Clause-এর সাথে যুক্ত হয়। এখানে 'I’ll get late' (I will get late) হলো Main Clause। Statement-টি Future Indefinite Tense-এ আছে এবং এটি Affirmative। Auxiliary verb হলো 'will'। যেহেতু Statement-টি Affirmative, Tag Question-টি Negative হবে। তাই 'will' এর Negative contracted form 'won’t' বসবে। Subject 'I' হওয়ায় Tag-এর pronounও 'I' হবে। সুতরাং, সঠিক Tag Questionটি হলো 'won’t I?'।</p>",
        },
        {
          id: 20,
          question: "Let’s go on a picnic, ___?",
          options: {
            a: "shall we",
            b: "won’t you",
            c: "isn’t it",
            d: "did we",
          },
          correct: "a",
          explanation:
            "<p>যদি কোনো Imperative Sentence 'Let’s' বা 'Let us' দিয়ে শুরু হয় (যা একটি প্রস্তাব বোঝায়), তাহলে Tag Question সবসময় 'shall we' হবে। এই নিয়মটি 'Let’s' বা 'Let us' যুক্ত সকল বাক্যের জন্য প্রযোজ্য। সুতরাং, সঠিক Tag Questionটি হলো 'shall we?'।</p>",
        },
      ];

      const totalQuestions = questions.length;
      let timeLeft = Math.floor(totalQuestions / 2) * 60;
      const timerElement = document.getElementById("timer");
      let timerInterval;

      function updateTimer() {
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        timerElement.innerText = `${toBengaliNumber(
          minutes
        )} মিনিট ${toBengaliNumber(seconds)} সেকেন্ড`;

        if (timeLeft > 0) {
          timeLeft--;
        } else {
          stopTimer();
          confirmSubmit();
        }
      }

      function startTimer() {
        console.log("Starting timer");
        timerElement.innerText = `${toBengaliNumber(
          Math.floor(timeLeft / 60)
        )} মিনিট ${toBengaliNumber(timeLeft % 60)} সেকেন্ড`;
        timerInterval = setInterval(updateTimer, 1000);
      }

      function stopTimer() {
        clearInterval(timerInterval);
        console.log("Timer stopped");
      }

      function toBengaliNumber(num) {
        const bengaliDigits = [
          "০",
          "১",
          "২",
          "৩",
          "৪",
          "৫",
          "৬",
          "৭",
          "৮",
          "৯",
        ];
        let numStr = num.toString();

        let isNegative = num < 0;
        if (isNegative) {
          numStr = numStr.substring(1);
        }

        if (numStr.includes(".")) {
          let [integerPart, decimalPart] = numStr.split(".");
          let integerBengali = integerPart
            .split("")
            .map((digit) => bengaliDigits[parseInt(digit)])
            .join("");
          let decimalBengali = decimalPart
            .split("")
            .map((digit) => bengaliDigits[parseInt(digit)])
            .join("");
          return (
            (isNegative ? "−" : "") + integerBengali + "." + decimalBengali
          );
        } else {
          let integerBengali = numStr
            .split("")
            .map((digit) => bengaliDigits[parseInt(digit)])
            .join("");
          return (isNegative ? "−" : "") + integerBengali;
        }
      }

      function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
      }

      function generateQuestions() {
        console.log("Generating questions");
        const examContainer = document.querySelector("#exam");
        if (!examContainer) {
          console.error("Exam container (#exam) not found!");
          return;
        }
        examContainer.innerHTML = "";
        console.log("Questions array:", questions);
        const shuffledQuestions = shuffleArray([...questions]);
        shuffledQuestions.forEach((question, index) => {
          console.log(`Generating question ${index + 1}:`, question);
          const questionDiv = document.createElement("div");
          questionDiv.classList.add("question-container");
          questionDiv.setAttribute("data-question", question.id);
          questionDiv.setAttribute("data-correct", question.correct);

          let optionsHTML = "";
          for (let option in question.options) {
            optionsHTML += `
                                                                          <label class="option" data-option="${option}">
                                                                            <div class="circle">${option}</div>
                                                                            <span class="option-text">${question.options[option]}</span>
                                                                          </label>
                                                                        `;
          }

          const explanationHTML = question.explanation
            ? `<div class="explanation-dropdown">
                                                                             <button class="explanation-btn">ব্যাখ্যা দেখো</button>
                                                                             <div class="explanation-content">
                                                                               <div class="explanation-label">ব্যাখ্যা:</div>
                                                                               ${question.explanation}
                                                                             </div>
                                                                           </div>`
            : "";

          questionDiv.innerHTML = `
                                                                        <p class="question-label">${
                                                                          index +
                                                                          1
                                                                        }. ${
            question.question
          }</p>
                                                                        <div class="options">
                                                                          ${optionsHTML}
                                                                        </div>
                                                                        ${explanationHTML}
                                                                      `;
          examContainer.appendChild(questionDiv);
          console.log(`Appended question ${index + 1} to exam container`);
        });

        const questionContainers = document.querySelectorAll(
          ".question-container"
        );
        console.log(`Found ${questionContainers.length} question containers`);
        questionContainers.forEach((container, idx) => {
          console.log(`Setting question ${idx + 1} to visible`);
          container.style.display = "block";
        });

        document.querySelectorAll(".option").forEach((option) => {
          option.addEventListener(
            "click",
            function (e) {
              e.preventDefault();
              const parent = this.closest(".question-container");
              if (parent.classList.contains("locked")) return;
              parent.classList.add("locked");
              parent.querySelectorAll(".option").forEach((el) => {
                if (el !== this) {
                  el.style.pointerEvents = "none";
                  el.style.cursor = "default";
                }
                el.classList.remove("selected");
              });
              this.classList.add("selected");
              console.log(
                `Option selected for question ${parent.getAttribute(
                  "data-question"
                )}: ${this.getAttribute("data-option")}`
              );
            },
            { once: true }
          );
        });

        document.querySelectorAll(".explanation-btn").forEach((btn) => {
          btn.addEventListener("click", function () {
            const content = this.nextElementSibling;
            content.classList.toggle("visible");
            this.classList.toggle("active");
            console.log("Toggled explanation visibility");
          });
        });

        const examInfo = document.getElementById("exam-info");
        if (examInfo) {
          examInfo.innerText = `পূর্ণ নম্বরঃ ${toBengaliNumber(
            totalQuestions
          )}`;
          console.log("Exam info updated");
        } else {
          console.error("Exam info element not found!");
        }
      }

      function initializeChart() {
        console.log("Initializing chart");
        const ctx = document.getElementById("scoreChart").getContext("2d");
        chartInstance = new Chart(ctx, {
          type: "pie",
          data: {
            labels: ["ঠিক উত্তর", "ভুল উত্তর", "অনুত্তরিত"],
            datasets: [
              {
                data: [0, 0, 0],
                backgroundColor: ["#34c759", "#ff3b30", "#007aff"],
                borderColor: "#fff",
                borderWidth: 2,
                hoverOffset: 10,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            cutout: "10%",
            layout: {
              padding: 10,
            },
            plugins: {
              legend: {
                position: "bottom",
                labels: {
                  font: {
                    family: '"Hind Siliguri", sans-serif',
                    size: 13,
                    weight: "bold",
                  },
                  color: "#333",
                  padding: 12,
                  boxWidth: 14,
                  generateLabels: (chart) => {
                    const data = chart.data;
                    return data.labels.map((label, i) => ({
                      text: label,
                      font: {
                        family: '"Hind Siliguri", sans-serif',
                      },
                      fillStyle: data.datasets[0].backgroundColor[i],
                      hidden: !chart.getDataVisibility(i),
                      index: i,
                    }));
                  },
                },
              },
              tooltip: {
                backgroundColor: "rgba(0, 0, 0, 0.9)",
                cornerRadius: 6,
                titleFont: {
                  family: '"Hind Siliguri", sans-serif',
                  size: 14,
                  weight: "bold",
                },
                bodyFont: {
                  family: '"Hind Siliguri", sans-serif',
                  size: 13,
                },
                padding: 10,
                boxPadding: 5,
              },
            },
            animation: {
              animateScale: true,
              animateRotate: true,
              duration: 1000,
              easing: "easeOutQuart",
            },
            elements: {
              arc: {
                borderRadius: 8,
              },
            },
            onClick: (e, elements) => {
              if (elements.length > 0) {
                const index = elements[0].index;
                const filter = ["correct", "wrong", "unanswered"][index];
                filterQuestions(filter);
              } else {
                filterQuestions("all");
              }
            },
          },
        });
        console.log("Chart initialized");
      }

      function filterQuestions(type) {
        console.log(`Filtering questions by type: ${type}`);
        document.querySelectorAll(".question-container").forEach((question) => {
          const status = question.getAttribute("data-status");
          if (type === "all" || status === type) {
            question.style.display = "block";
          } else {
            question.style.display = "none";
          }
        });
      }

      function showConfirmPopup() {
        console.log("Showing confirm popup");
        document.getElementById("confirmPopup").style.display = "block";
      }

      function autoSubmitScore() {
        console.log("Auto-submitting score");
        stopTimer();
        let score = 0,
          total = questions.length,
          answered = 0,
          correct = 0,
          wrong = 0,
          unanswered = 0;

        document.querySelectorAll(".question-container").forEach((question) => {
          let correctAnswer = question.getAttribute("data-correct");
          let selectedOption = question.querySelector(".option.selected");

          if (selectedOption) {
            answered++;
            let chosenAnswer = selectedOption.getAttribute("data-option");
            if (chosenAnswer === correctAnswer) {
              score += 1;
              correct++;
              question.setAttribute("data-status", "correct");
            } else {
              score -= 0.25;
              wrong++;
              question.setAttribute("data-status", "wrong");
            }
          } else {
            unanswered++;
            question.setAttribute("data-status", "unanswered");
          }
        });

        const userID = sessionStorage.getItem("userID") || "anonymous";
        const formData = new FormData();
        formData.append("userID", userID);
        formData.append("finalScore", score.toFixed(2));
        formData.append("correctAnswers", correct);
        formData.append("wrongAnswers", wrong);
        formData.append("unanswered", unanswered);

        const url = "https://formspree.io/f/xpwy";
        navigator.sendBeacon(url, formData);
        console.log("Auto-submission sent via sendBeacon for userID:", userID);
      }

      function confirmSubmit() {
        console.log("Confirming submission");
        document.getElementById("confirmPopup").style.display = "none";
        stopTimer();
        let score = 0,
          total = questions.length,
          answered = 0,
          correct = 0,
          wrong = 0,
          unanswered = 0;

        document
          .querySelectorAll(".question-container")
          .forEach((question, index) => {
            let correctAnswer = question.getAttribute("data-correct");
            let selectedOption = question.querySelector(".option.selected");

            if (selectedOption) {
              answered++;
              let chosenAnswer = selectedOption.getAttribute("data-option");
              if (chosenAnswer === correctAnswer) {
                selectedOption
                  .querySelector(".option-text")
                  .classList.add("correct-text");
                score += 1;
                correct++;
                question.setAttribute("data-status", "correct");
              } else {
                selectedOption
                  .querySelector(".option-text")
                  .classList.add("incorrect-text");
                question
                  .querySelector(
                    `[data-option="${correctAnswer}"] .option-text`
                  )
                  .classList.add("correct-text");
                score -= 0.25;
                wrong++;
                question.setAttribute("data-status", "wrong");
              }
            } else {
              question
                .querySelector(`[data-option="${correctAnswer}"] .option-text`)
                .classList.add("unattempted-text");
              unanswered++;
              question.setAttribute("data-status", "unanswered");
            }
            question.style.display = "block";

            const explanationDropdown = question.querySelector(
              ".explanation-dropdown"
            );
            if (explanationDropdown) {
              explanationDropdown.classList.add("visible");
            }
          });

        const chartContainer = document.querySelector(".chart-container");
        chartContainer.classList.add("visible");
        if (!chartInstance) {
          initializeChart();
        }
        chartInstance.data.datasets[0].data = [correct, wrong, unanswered];
        chartInstance.update();
        console.log("Chart updated with data:", [correct, wrong, unanswered]);

        const userID = sessionStorage.getItem("userID") || "anonymous";
        document.getElementById("totalQuestions").innerText =
          toBengaliNumber(total);
        document.getElementById("answered").innerText =
          toBengaliNumber(answered);
        document.getElementById("correctAnswers").innerText =
          toBengaliNumber(correct);
        document.getElementById("wrongAnswers").innerText =
          toBengaliNumber(wrong);
        document.getElementById("unanswered").innerText =
          toBengaliNumber(unanswered);
        document.getElementById("finalScore").innerText = toBengaliNumber(
          score.toFixed(2)
        );

        document.getElementById("formUserID").value = userID;
        document.getElementById("formFinalScore").value = score.toFixed(2);
        document.getElementById("formCorrectAnswers").value = correct;
        document.getElementById("formWrongAnswers").value = wrong;
        document.getElementById("formUnanswered").value = unanswered;

        document.getElementById("submitBtn").style.display = "none";

        document.getElementById("scorePopup").style.display = "block";

        const form = document.getElementById("scoreForm");
        fetch(form.action, {
          method: "POST",
          body: new FormData(form),
          headers: {
            Accept: "application/json",
          },
        })
          .then((response) => {
            if (response.ok) {
              console.log("Form submitted successfully");
              form.reset();
            } else {
              console.error("Form submission failed:", response.statusText);
            }
          })
          .catch((error) => {
            console.error("Error:", error);
          });
      }

      function cancelSubmit() {
        console.log("Canceling submission");
        document.getElementById("confirmPopup").style.display = "none";
      }

      document
        .getElementById("submitBtn")
        .addEventListener("click", function () {
          console.log("Submit button clicked");
          showConfirmPopup();
        });

      function closePopup() {
        console.log("Closing score popup");
        const scorePopup = document.getElementById("scorePopup");
        scorePopup.classList.add("slide-out");
        setTimeout(() => {
          scorePopup.style.display = "none";
          scorePopup.classList.remove("slide-out");
          window.scrollTo({ top: 0, behavior: "smooth" });
        }, 500);
      }

      document
        .getElementById("scoreForm")
        .addEventListener("submit", function (event) {
          event.preventDefault();
          console.log("Score form submitted");
          closePopup();
        });
    </script>
  </body>
</html>
